# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer:
pkgname=sbcl
pkgver=1.4.9
pkgrel=0
pkgdesc="Steel Bank Common Lisp"
url="http://www.sbcl.org/"
arch="x86_64"
license="custom"
makedepends="clisp linux-headers paxmark zlib-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.bz2::http://prdownloads.sourceforge.net/$pkgname/$pkgname-$pkgver-source.tar.bz2
	pax-genesis-stage-two.patch
	ignore-test-failure.patch
	musl-fixes.patch
	sbcl_prefix.patch
	"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	default_prepare

	cp "$srcdir"/config "$builddir"/customize-target-features.lisp
}

build() {
	cd "$builddir"
	GNUMAKE=make ./make.sh "clisp" --prefix=/usr
}

package() {
	cd "$builddir"

	INSTALL_ROOT="$pkgdir/usr" \
		LIB_DIR="/usr/lib" \
		DOC_DIR="$pkgdir/usr/share/doc/$pkgname" \
		sh install.sh

	paxmark -rm "$pkgdir"/usr/bin/sbcl

	install -Dm644 COPYING \
		"$pkgdir"/usr/share/licenses/$pkgname/LICENSE.txt

	rmdir "$pkgdir"/usr/share/doc/sbcl/html \
		"$pkgdir"/usr/share/info 2>/dev/null || true
}

sha512sums="e0248f460f9737d47653dd520732062d2637813b550df356ecc90aa6d21fbdd74f03182d1e890c09c1da742f7d57b4fbd04a4e6dc36999aca51bb6c2952ac236  sbcl-1.4.9.tar.bz2
cda5c7268b314145a1bdb8293c7970e077aebf3cce5dace12542bf18beb7b124bf97f4754906f2f681428869ca3060300b88cab80055a3d5881dfcdcfbe51d6d  pax-genesis-stage-two.patch
fcaf0754084d705b263cbca20988e2cacc96470d4f0f2e15b812678ba8d15a43de2b3ebd87648f6540833615fdbde0011f72ce7800b02dcbd8055229eb439ec3  ignore-test-failure.patch
19bb9dac5997366c9778e349b707970832c5020ac55f0099dd652a8cc8c43336d34a33db2e4f7f190ab8212b064718f6999b832c249a4de7d24eae2186d6acea  musl-fixes.patch
bfb6bef3b6512e487e45bc8c9cf36aa519e470690b6c7036bba7d28269bd899c60a4dfa09b5aba44830b8c002e7191276f2cf6f8f134b163d05af7b46f9849ff  sbcl_prefix.patch"
