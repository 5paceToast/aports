# Maintainer: Leonardo Arena <rnalrd@alpinelinux.org>
pkgname=openscenegraph
pkgver=3.4.1
pkgrel=2
pkgdesc="High performance 3D graphics toolkit"
url="https://openscenegraph.org"
arch="all"
license="Custom wxWindows-3 LGPL-2.1"
makedepends="$depends_dev cmake mesa-dev jasper-dev curl-dev giflib-dev zlib-dev
	freetype-dev jpeg-dev tiff-dev sdl-dev sdl2-dev libxml2-dev gdal-dev"
subpackages="$pkgname-dev $pkgname-doc"
source="https://github.com/openscenegraph/OpenSceneGraph/archive/OpenSceneGraph-$pkgver.tar.gz
	musl-fixes.patch
	add-missing-include-for-ppc64le.patch
	"
builddir="$srcdir"/OpenSceneGraph-OpenSceneGraph-$pkgver

prepare() {
	default_prepare
	cmake . -DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_CXX_FLAGS="$CXXFLAGS -Wno-narrowing"
}

build() {
	cd "$builddir"
	make
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	install -D -m644 LICENSE.txt "$pkgdir/usr/share/doc/$pkgname/LICENSE"
	[ -d "$pkgdir/usr/lib64" ] && mv "$pkgdir/usr/lib64" "$pkgdir/usr/lib" || true
}

sha512sums="5133896804ab5237cd092893cf8c0492f23ccffbbba0cdd0add7dc079b1d444ee2f0835f84d5e78ec1b52ba99a2e07bca393cd4eadb4f3b4e0c37ba158fb2a97  OpenSceneGraph-3.6.1.tar.gz
016b09874bd6ca14cf1dba9274df4fc0413d2d97c3438135ecf6c5726029963f1ff279eb4986afe86173739512799e1e8ee5f7443e30fe1131524405a9d002be  musl-fixes.patch
a3e69609b2e3c51002f4babd1c5bd64fc9c32b14fc9232f4b4f345c6e96134bc80a0fe54ce3445059b4d0512d5ac1ec434101fe976b71f24c68b3569265e21d9  add-missing-include-for-ppc64le.patch"
