# Contributor: Hidde van der Heide <hvanderheide@nexuz.net>
# Maintainer:
pkgname=opendmarc
pkgver=1.3.2
pkgrel=0
pkgdesc="A free open source implementation of the DMARC specification"
url="http://www.trusteddomain.org/opendmarc/"
arch="all"
license="BSD-3-Clause Sendmail"
makedepends="libmilter-dev libspf2-dev"
subpackages="$pkgname-doc $pkgname-dev"
source="https://downloads.sourceforge.net/project/$pkgname/$pkgname-$pkgver.tar.gz
	netdb_defines.patch
	"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	default_prepare
	update_config_guess
	update_config_sub
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--with-installdir=/usr \
		--with-spf \
		--with-spf2-lib=/usr/lib \
		--with-spf2-include=/usr/include/spf2
	make
}

check() {
	cd "$builddir"
	opendmarc/opendmarc -V
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="6045fb7d2be8f0ffdeca07324857d92908a41c6792749017c2fcc1058f05f55317b1919c67c780827dd7094ec8fff2e1fa4aeb5bab7ff7461537957af2652748  opendmarc-1.3.2.tar.gz
a6808ac27264c84a8f7210ccc67f03028bc3644542c4def30824e6342a3fb207615c7b4b21f38084523df0b4dd777fbb6e9d3802bb50b41d3c5b0ce29ebfeff7  netdb_defines.patch"
