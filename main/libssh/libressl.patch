diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 20c0780..c1633f4 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -164,9 +164,9 @@ else (WITH_GCRYPT)
         pki_crypto.c
         libcrypto.c
        )
-    if(OPENSSL_VERSION VERSION_LESS "1.1.0")
+#    if(OPENSSL_VERSION VERSION_LESS "1.1.0")
         set(libssh_SRCS ${libssh_SRCS} libcrypto-compat.c)
-    endif()
+#    endif()
 endif (WITH_GCRYPT)
 
 if (WITH_SFTP)
diff --git a/src/libcrypto-compat.c b/src/libcrypto-compat.c
index 4b1f36a..4fa6537 100644
--- a/src/libcrypto-compat.c
+++ b/src/libcrypto-compat.c
@@ -302,7 +302,7 @@ void HMAC_CTX_free(HMAC_CTX *ctx)
 {
     if (ctx != NULL) {
         hmac_ctx_cleanup(ctx);
-#if OPENSSL_VERSION_NUMBER > 0x10100000L
+#if (OPENSSL_VERSION_NUMBER > 0x10100000L) && !defined(LIBRESSL_VERSION_NUMBER)
         EVP_MD_CTX_free(&ctx->i_ctx);
         EVP_MD_CTX_free(&ctx->o_ctx);
         EVP_MD_CTX_free(&ctx->md_ctx);
diff --git a/src/libcrypto-compat.h b/src/libcrypto-compat.h
index 21542c6..532b0fb 100644
--- a/src/libcrypto-compat.h
+++ b/src/libcrypto-compat.h
@@ -2,7 +2,7 @@
 #define LIBCRYPTO_COMPAT_H
 
 #include <openssl/opensslv.h>
-#if OPENSSL_VERSION_NUMBER < 0x10100000L
+#if (OPENSSL_VERSION_NUMBER < 0x10100000L) || defined(LIBRESSL_VERSION_NUMBER)
 
 #include <openssl/rsa.h>
 #include <openssl/dsa.h>
