# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=newsbeuter
pkgver=2.9
pkgrel=5
pkgdesc="Configurable text-based feed reader"
url="http://newsbeuter.org/"
arch="all"
license="MIT"
depends=""
depends_dev=""
makedepends="$depends_dev json-c-dev curl-dev ncurses-dev sqlite-dev
	stfl-dev libxml2-dev gettext-dev perl"
install=""
subpackages="$pkgname-doc $pkgname-lang"
source="http://newsbeuter.org/downloads/newsbeuter-$pkgver.tar.gz
	0001-Remove-iconv-translit-references.patch
	newsbeuter-2.9-ncurses6.patch
	fix-segfault.patch
	CVE-2017-12904.patch
	CVE-2017-14500.patch
	"

# secfixes:
#   2.9-r5:
#     - CVE-2017-14500
#   2.9-r4:
#     - CVE-2017-12904

_builddir="$srcdir"/newsbeuter-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./config.sh || return 1
	echo "LDFLAGS+=-lintl" >> config.mk

	make prefix=/usr || return 1

}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" prefix=/usr install || return 1
}

md5sums="9cf332dc7e591023147bda7add430835  newsbeuter-2.9.tar.gz
2d158695303d3605425d5b30465408b8  0001-Remove-iconv-translit-references.patch
6450d3794d543f9edae934f86a3ce7ef  newsbeuter-2.9-ncurses6.patch
bbf607a93fa88d75a137e60b2b4d8eba  fix-segfault.patch
1d47db94b79327075b433bb6f1c79968  CVE-2017-12904.patch
f005dead83edcdcddef3d69179bfcc1f  CVE-2017-14500.patch"
sha256sums="74a8bf019b09c3b270ba95adc29f2bbe48ea1f55cc0634276b21fcce1f043dc8  newsbeuter-2.9.tar.gz
122613fd512a17f938d98ceb5aa3a1a9ddcff7dc4e7ac640e490637d2f645ba9  0001-Remove-iconv-translit-references.patch
5ae54c463f44d91725da3be655d2b107d598ade6da86ab4a99b10b039b8dba27  newsbeuter-2.9-ncurses6.patch
6359708ee01f5e1b773a6ed79b7369b30aad5397b85fd252c2fa7d0c2616ea86  fix-segfault.patch
6e31fa282a6f420063603845194d292c779f450e3cd5afc2323ae86c8c14f664  CVE-2017-12904.patch
db60ed4828ffd8e468583d869667fdf7df1d501a0b7f732b6385872c749a4e06  CVE-2017-14500.patch"
sha512sums="b173008c8c8d3729f8ccef3ce62645a05c1803fb842d5c0afdf9ffd4ed3726030f9c359c20bc817402a6a0ea12af742d0ae7faf9b92d52c11f420f62b430b0aa  newsbeuter-2.9.tar.gz
1cfbe93cd8ca5785b1c26ccfdf1ed467700046c8ca564f33752b0f04f91d37765f83bf82ad593eae41532edf79a8f6992283255f9a2aa8293d14728b175c9dd7  0001-Remove-iconv-translit-references.patch
08f7125fd8f2b33fa5e36cbd947ec90bcd8b08be2df7961aced20ce031788b3970c1adeb027b1527ba06f18ddbc38518f2c22da6b5fdbc4b1cd5b0edda22ba0b  newsbeuter-2.9-ncurses6.patch
da986beb12b0ba473fea55c067abcdcdae6c073bf4d66bc8913696a4da99c4072edaf3910769d8e4bcef3a0411875eb23fbc840e0e7572aa0e16e922cc3d2947  fix-segfault.patch
cef1a625781081430bcaa7fbec74a58ce656a22cd94d5ff1a6983165e053fdfbd869aebd8041fb34a7325a312f15c84b2a1093d237e2680b9244f0917baa1c4c  CVE-2017-12904.patch
8836fa3fa48268a5492e3ba16e4d4fc47514ee4ba661cc84c6ea87b61abd7bdfd438fa90fcb0546b75212a9cf5ea9e001396a32fad223500d65bad76b1bfc6f3  CVE-2017-14500.patch"
