# Contributor: Jon Ong <jonongjs@rottenmage.com>
# Maintainer: Anil Madhavapeddy <anil@recoil.org>
pkgname=ocaml-camlp4
_pkgname=camlp4
# NOTE: camlp4 version must match ocaml version!
pkgver=4.04
_versuffix='+1'
_pkgver=$pkgver$_versuffix
pkgrel=1
pkgdesc="Caml preprocessor and pretty-printer"
url="https://github.com/ocaml/camlp4/releases"
arch="all !x86 !armhf !s390x"  # ocaml not avail on excluded platforms
license="LGPL-2.0-or-later-WITH-linking-exception"
depends="ocaml"
makedepends="ocamlbuild"
replaces="camlp4"  # for backward compatibility
provides="camlp4=$pkgver-r$pkgrel"  # for backward compatibility
source="$_pkgname-$_pkgver.tar.gz::https://github.com/ocaml/$_pkgname/archive/$_pkgver.tar.gz"
builddir="$srcdir/$_pkgname-${_pkgver/+/-}"

build() {
	cd "$builddir"

	./configure
	make -j1 all camlp4/META
}

package() {
	cd "$builddir"

	make BINDIR="$pkgdir/usr/bin" \
		LIBDIR="$pkgdir/usr/lib/ocaml" \
		PKGDIR="$pkgdir/usr/lib/ocaml" \
		install install-META
}

sha512sums="7db8eebcf3d230f60650ba62d9cb630c069394237e97b678a40b61d3dcaded752a2b7e089a50ff528f1ea0740d0291b722df123a072f2cee489cadc5201c6776  camlp4-4.04+1.tar.gz"
